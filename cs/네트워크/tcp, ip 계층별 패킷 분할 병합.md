## ⚙️ TCP vs IP: 패킷 분할/병합의 차이점

|항목|TCP에서의 분할/병합|IP에서의 분할/병합|
|---|---|---|
|**계층**|전송 계층 (Transport Layer)|인터넷 계층 (Internet Layer)|
|**분할 목적**|애플리케이션 데이터가 너무 클 경우, 수신 측에서 재조립 가능하도록 분할|IP 패킷이 네트워크의 MTU(Maximum Transmission Unit)를 초과할 경우 분할|
|**병합 위치**|수신 측 TCP가 순서대로 병합하여 애플리케이션에 전달|수신 측 IP 계층에서 병합 (Fragment Offset 기반)|
|**순서 보장**|TCP는 순서 보장 (Sequence Number 사용)|IP는 순서 보장 없음 (Best-Effort 방식)|
|**오류 처리**|손실 시 재전송 (신뢰성 보장)|손실 시 재전송 없음 (신뢰성 없음)|
|**헤더 정보**|Sequence Number, Acknowledgment Number 등 포함|Fragment Offset, Identification, MF(More Fragment) 등 포함|
|**병합 실패 시**|재전송 요청 가능|병합 실패 시 전체 패킷 폐기|

### 요약

- **TCP**는 신뢰성 있는 연결을 제공하기 위해 **논리적인 데이터 흐름**을 관리합니다. 애플리케이션이 보낸 데이터를 적절한 크기로 나누고, 수신 측에서 정확히 병합합니다.
    
- **IP**는 물리적인 네트워크 제약(MTU)에 따라 **물리적인 패킷 분할**을 수행합니다. 병합은 수신 측에서 자동으로 이루어지며, 실패 시 복구가 어렵습니다.


## 🧩 두 번의 분할: TCP → IP

### 1️⃣ **TCP 계층에서의 분할**

- 애플리케이션이 보낸 데이터가 크면, TCP는 이를 **세그먼트(segment)** 단위로 나눕니다.
    
- 각 세그먼트에는 **순서 번호(Sequence Number)** 가 붙고, 수신 측에서 정확한 순서로 병합할 수 있도록 설계되어 있어요.
    
- 이 과정은 **논리적 분할**이며, 신뢰성과 순서를 보장합니다.
    

### 2️⃣ **IP 계층에서의 분할 (Fragmentation)**

- TCP가 만든 세그먼트가 **네트워크의 MTU(Maximum Transmission Unit)** 보다 크면, IP는 이를 다시 **조각(fragment)** 으로 나눕니다.
    
- 각 조각에는 **Fragment Offset**, **Identification**, **More Fragment(MF)** 플래그가 포함되어, 수신 측에서 재조립할 수 있게 합니다.
    
- 이건 **물리적 분할**이며, IP는 신뢰성을 보장하지 않기 때문에 조각 중 하나라도 손실되면 전체 패킷이 폐기될 수 있어요.
    

### 🔁 병합은 어떻게?

- **TCP 병합**: 수신 측 TCP가 세그먼트를 순서대로 병합 → 애플리케이션에 전달
    
- **IP 병합**: 수신 측 IP 계층이 조각들을 모아 원래의 IP 패킷으로 복원 → 상위 계층(TCP)으로 전달

```
예시

[애플리케이션 데이터]
      ↓
[TCP] → 세그먼트1, 세그먼트2, ...
      ↓
[IP] → 세그먼트1이 너무 크면 → Fragment1, Fragment2, ...
      ↓
[전송]

```