
### 2PC란?

**2PC (Two-Phase Commit)**는 **분산 트랜잭션**에서 **데이터 일관성과 원자성**을 보장하기 위한 프로토콜이에요. 여러 시스템이나 데이터베이스가 동시에 하나의 트랜잭션에 참여할 때, 모두 성공하거나 모두 실패하도록 조율하는 방식이죠.

---

###  동작 방식

2PC는 이름처럼 **두 단계**로 진행됩니다:

#### 1️ 준비 단계 (Prepare Phase)

- **Coordinator**가 모든 참여자(Participants)에게 “커밋할 준비 됐나요?”라고 묻는 메시지를 보냅니다.
- 참여자들은 로컬 트랜잭션을 준비하고, 준비가 되면 “준비 완료(Prepared)” 메시지를 보내고, 문제가 있으면 “중단(Abort)” 메시지를 보냅니다.

#### 2️ 커밋/중단 단계 (Commit/Abort Phase)

- 모든 참여자가 “준비 완료”라고 응답하면, Coordinator는 “커밋하자!”라고 지시합니다.
- 하나라도 “중단” 메시지를 보내면, 전체 트랜잭션을 **롤백**합니다.
- 참여자들은 지시에 따라 커밋하거나 롤백하고, 완료 메시지를 Coordinator에게 보냅니다.

---

###  사용처

- **은행 시스템**: 여러 계좌 간 이체 시
- **전자상거래**: 주문, 결제, 재고 처리 등 여러 서비스가 동시에 작동할 때
- **마이크로서비스 아키텍처**: 서비스 간 데이터 일관성 유지가 필요할 때

---

###  단점

- **Coordinator가 장애**를 일으키면 전체 트랜잭션이 멈출 수 있어요.
- **지연 시간**이 길어질 수 있고, **확장성**에 제약이 생길 수 있어요.

이해가 좀 더 필요하거나, Saga 패턴 같은 대안도 궁금하다면 이어서 설명해줄게요!