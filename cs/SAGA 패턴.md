SAGA 패턴은 마이크로서비스 아키텍처에서 **분산 트랜잭션의 데이터 일관성을 유지**하기 위한 설계 방식이다. 특히 **2PC(2-Phase Commit)**의 복잡성과 낮은 가용성을 피하고자 등장했죠.

---

###  SAGA 패턴이란?

**SAGA 패턴**은 하나의 큰 트랜잭션을 여러 개의 **로컬 트랜잭션(Local Transaction)**으로 나누고, 각 단계가 성공하면 다음 단계로 넘어가는 방식이에요. 만약 중간에 실패하면, 이전 단계들을 **보상 트랜잭션(Compensating Transaction)**으로 되돌려서 전체 비즈니스 일관성을 유지합니다 [Microsoft Learn](https://learn.microsoft.com/ko-kr/azure/architecture/patterns/saga) [hudi.blog](https://hudi.blog/saga-pattern/).

---

###  동작 방식

1. **첫 번째 서비스**가 로컬 트랜잭션을 수행하고 이벤트를 발생시킴
2. **두 번째 서비스**는 그 이벤트를 받아 다음 트랜잭션을 수행
3. 이런 식으로 트랜잭션이 이어짐
4. 중간에 실패하면, 이전 단계에 대해 **취소 작업(보상 트랜잭션)**을 실행

---

###  예시 시나리오

> 고객이 상품을 주문하면:

- 주문 서비스가 주문을 생성
- 배송 서비스가 배송을 시작
- 상품 서비스가 재고를 감소
- 만약 배송 실패 시, 주문을 취소하고 재고를 복구하는 보상 트랜잭션 실행 [hudi.blog](https://hudi.blog/saga-pattern/)

---

###  SAGA vs [[2PC(2 Phase Consistency) |2PC]]

|항목|SAGA 패턴|2PC|
|---|---|---|
|일관성|최종적 일관성(Eventual Consistency)|강력한 일관성|
|가용성|높음|낮음|
|복잡성|보상 로직 필요|Coordinator 필요|
|장애 복구|유연함|장애 시 전체 트랜잭션 중단 가능|

---

###  언제 쓰면 좋을까?

- 마이크로서비스 간 데이터베이스가 분리되어 있을 때
- 높은 가용성과 유연한 장애 복구가 필요한 시스템
- 은행, 쇼핑몰, 예약 시스템 등 다양한 서비스가 연계되는 경우
