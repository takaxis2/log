## 핵심 요약

본 문서는 운영체제 내에서 발생하는 교착상태(Deadlock)의 개념, 발생 조건, 그리고 다양한 처리 방법론을 종합적으로 분석한다. 교착상태는 둘 이상의 프로세스가 상대방이 점유한 자원을 무한정 기다리며 영구적으로 블로킹된 상태를 의미한다.

교착상태가 발생하기 위해서는 **상호 배제**, **점유와 대기**, **비선점**, **순환 대기**라는 네 가지 조건이 동시에 충족되어야 한다. 이러한 발생 조건을 제어하는 방식에 따라 교착상태 처리 방법은 크게 세 가지로 분류된다. 첫째, 네 가지 조건 중 하나를 원천적으로 제거하여 교착상태 발생을 막는 **교착상태 예방(Prevention)**. 둘째, 자원 할당 시 시스템이 불안전한 상태에 빠지지 않도록 동적으로 검사하는 **교착상태 회피(Avoidance)**. 셋째, 교착상태 발생을 허용하되, 이를 주기적으로 탐지하여 해결하는 **교착상태 탐지 및 회복(Detection & Recovery)**이다.

실제로는 교착상태가 드물게 발생하며 처리 비용이 높다는 점에서, UNIX를 포함한 대부분의 상용 운영체제는 교착상태를 의도적으로 **무시(Ignoring)**하고 문제 발생 시 시스템 재시작과 같은 수동적 조치에 의존하는 방식을 채택하고 있다.

--------------------------------------------------------------------------------

## 1. 교착상태의 개념과 시스템 모델

### 1.1. 교착상태의 정의

교착상태(Deadlock)란 시스템 자원을 사용하기 위해 경쟁하는 프로세스 집합에서, 각 프로세스가 집합 내의 다른 프로세스가 점유한 자원을 기다리며 영구적으로 블로킹(blocking)된 상태를 지칭한다. 즉, 대기 중인 프로세스들이 필요로 하는 자원이 다른 대기 중인 프로세스에 의해 점유되어 있어, 어떤 프로세스도 자신의 상태를 변경시켜 작업을 계속 진행할 수 없는 상황이다.

이는 하나 또는 그 이상의 프로세스가 자원의 할당과 해제를 무한정 기다리는 상태로, 두 개 이상의 프로세스가 자신이 점유한 자원을 놓지 않으면서 상대방 프로세스가 점유한 자원을 동시에 요구할 때 발생한다.

### 1.2. 시스템 모델

운영체제 내에서 교착상태를 이해하기 위한 시스템 모델은 다음과 같은 구성 요소로 이루어진다.

- **자원(Resources):** 시스템은 주기억장치 공간, CPU 주기, 입출력 장치, 파일 등 유한한 수의 자원을 가진다.
- **프로세스(Processes):** 여러 프로세스가 한정된 자원을 획득하기 위해 경쟁하며, 자원의 수보다 자원을 요청하는 프로세스가 많을 경우 대기 상태에 들어간다.

프로세스의 자원 사용은 다음과 같은 3단계 절차를 따른다.

1. **요청(Request):** 프로세스가 자원 사용을 요청한다. 요청이 즉시 허용되지 않거나 다른 프로세스가 해당 자원을 사용 중이면 대기해야 한다.
2. **사용(Use):** 자원 사용이 허락되면, 프로세스는 해당 자원을 점유하여 작업을 수행한다.
3. **해제(Release):** 자원 사용이 모두 끝나면, 다른 프로세스가 사용할 수 있도록 자원을 해제한다.

자원의 요청과 해제는 주로 시스템 호출(System Call)을 통해 수행되며, 자원 대기는 세마포어(Semaphore) 등을 이용해 구현된다.

## 2. 교착상태 발생의 4가지 필요조건

교착상태는 다음 네 가지 조건이 시스템 내에서 동시에 충족될 때 발생할 수 있다. 이 중 하나라도 만족되지 않으면 교착상태는 발생하지 않는다.

### 2.1. 상호 배제 (Mutual Exclusion)

최소한 하나의 자원이 비공유(non-sharable) 모드로 점유되어야 한다. 즉, 한 번에 한 프로세스만이 해당 자원을 사용할 수 있으며, 다른 프로세스가 그 자원을 요청할 경우 요청한 프로세스는 자원이 해제될 때까지 대기해야 한다. 이는 자원에 대한 배타적인 제어권을 의미한다.

### 2.2. 점유와 대기 (Hold and Wait)

프로세스는 최소한 하나 이상의 자원을 점유한 상태에서, 다른 프로세스에 할당된 추가 자원을 얻기 위해 대기하고 있어야 한다. 이를 '부분 할당'이라고도 부르며, 이미 할당받은 자원을 놓지 않은 채 다른 자원을 추가로 요구하는 상태를 말한다.

### 2.3. 비선점 (Non-preemption)

프로세스에 할당된 자원은 해당 프로세스가 작업을 마치고 자발적으로 해제할 때까지 강제로 빼앗을 수 없다. 자원은 점유하고 있는 프로세스에 의해서만 해제될 수 있으며, 도중에 회수될 수 없다.

### 2.4. 순환 대기 (Circular Wait / 환형 대기)

대기 중인 프로세스들의 집합 {P₀, P₁, ..., Pₙ}이 존재하여, P₀는 P₁이 점유한 자원을, P₁은 P₂가 점유한 자원을, ..., 그리고 Pₙ은 P₀가 점유한 자원을 기다리는 원형의 대기 사슬이 형성되어야 한다. 이는 자원 할당 그래프(Resource Allocation Graph)에서 사이클(cycle)이 형성되는 것으로 시각화될 수 있다.

|   |   |
|---|---|
|조건|설명|
|**상호 배제**|한 번에 한 프로세스만 자원 사용 가능 (비공유 자원)|
|**점유와 대기**|자원을 보유한 상태에서 다른 자원을 추가로 대기|
|**비선점**|할당된 자원은 강제로 빼앗을 수 없음|
|**순환 대기**|프로세스들이 원형으로 서로의 자원을 기다림|

## 3. 교착상태 처리 방법론

교착상태를 처리하는 접근법은 크게 세 가지 전략과 하나의 현실적인 타협안으로 나뉜다.

### 3.1. 교착상태 무시 (Ignoring Deadlock)

교착상태를 처리하기 위한 예방, 회피, 탐지 알고리즘은 상당한 시스템 오버헤드를 유발한다. 실제 시스템에서 교착상태는 드물게 발생하므로(예: 1년에 한 번), 이러한 비용을 감수하는 대신 문제를 무시하는 방법이다.

- **적용:** UNIX를 포함한 대부분의 상용 운영체제가 이 방식을 채택한다.
- **장점:** 처리 비용이 거의 들지 않는다.
- **단점:** 교착상태 발생 시 시스템을 재시작해야 하는 등 수동적인 해결이 필요하다.

### 3.2. 교착상태 예방 (Deadlock Prevention)

교착상태 발생의 4가지 필요조건 중 최소 하나를 만족시키지 않도록 시스템을 설계하는 방법이다.

- **상호 배제 조건 부정:** 자원의 공유를 허용한다. 읽기 전용 파일처럼 공유 가능한 자원에는 적용 가능하지만, 프린터나 쓰기 가능한 파일 등 본질적으로 공유가 불가능한 자원이 많아 현실적으로 적용하기 어렵다.
- **점유와 대기 조건 부정:**
    
    1. 프로세스가 실행 전 필요한 모든 자원을 한 번에 요청하고 할당받도록 한다.
    2. 프로세스가 자원을 추가로 요청할 때는, 기존에 보유한 모든 자원을 방출한 후 요청하도록 한다.
    
    - **문제점:** 자원 활용 효율성이 크게 감소하고, 특정 자원에 대한 요청이 빈번할 경우 기아(Starvation) 상태가 발생할 수 있다.
- **비선점 조건 부정:** 다른 자원을 요청한 프로세스가 즉시 할당받지 못하면, 현재 점유하고 있는 모든 자원을 강제로 해제(선점)시킨다. 이 프로세스는 나중에 자신이 요청한 자원과 이전에 점유했던 자원을 모두 다시 획득할 수 있을 때 실행을 재개한다.
- **순환 대기 조건 부정:** 모든 자원 유형에 고유한 번호를 부여하여 전체적인 순서를 정하고, 각 프로세스는 현재 보유한 자원의 번호보다 큰 번호를 가진 자원만 요청할 수 있도록 강제한다.

교착상태 예방 기법들은 자원 이용률 저하와 시스템 처리율 감소라는 부작용을 초래할 수 있다.

### 3.3. 교착상태 회피 (Deadlock Avoidance)

자원 요청에 대한 부가적인 정보(예: 프로세스가 앞으로 사용할 자원의 최대량)를 활용하여, 자원 할당 후에도 시스템이 교착상태를 유발하지 않는 **안정 상태(Safe State)**에 머무를 것인지 사전에 예측하고 결정하는 방법이다.

- **핵심 개념:** 시스템을 항상 안정 상태로 유지하여 불안전한 상태(Unsafe State)로 진입하는 것을 막는다. 안정 상태는 모든 프로세스가 교착상태 없이 자원을 할당받고 종료될 수 있는 순서가 존재하는 상태를 의미한다.
- **대표 알고리즘:** **은행가 알고리즘(Banker's Algorithm)**은 자원 할당 요청이 발생할 때마다, 그 요청을 수락해도 시스템이 안정 상태를 유지하는지 검사하여 교착상태를 회피하는 기법이다.
- **문제점:** 부가 정보 유지 및 알고리즘 실행에 따른 운영체제의 부담이 크다.

### 3.4. 교착상태 탐지 및 회복 (Deadlock Detection & Recovery)

교착상태 발생을 허용하되, 주기적으로 시스템을 검사하여 교착상태를 **탐지(Detection)**하고, 발견되면 이를 해결하는 **회복(Recovery)** 절차를 수행하는 방법이다.

#### 3.4.1. 탐지

시스템의 자원 할당 상태를 주기적으로 분석하여 순환 대기(cycle)가 존재하는지 판단한다.

#### 3.4.2. 회복

탐지된 교착상태를 해결하는 방법은 주로 두 가지이다.

1. **프로세스 종료 (Process Termination):**
    - **모두 종료:** 교착상태에 관련된 모든 프로세스를 종료한다. 순환 대기를 확실히 해결하지만, 지금까지의 작업 내용이 모두 손실되어 비용이 매우 크다.
    - **하나씩 종료:** 순환 대기가 깨질 때까지 프로세스를 하나씩 종료한다. 비용은 적지만, 교착상태가 해결되지 않으면 추가적인 프로세스 종료가 필요할 수 있다.
    - **희생자 선정 기준:** 어떤 프로세스를 종료할지 결정하기 위해 프로세스의 우선순위, 실행 시간, 점유 자원의 수와 종류, 종료에 필요한 자원 수 등을 고려한다.
2. **자원 선점 (Resource Preemption):**
    - 교착상태 해결을 위해 특정 프로세스로부터 자원을 강제로 회수하여 다른 프로세스에 할당한다.
    - **고려 요소:**
        - **희생자 선택(Victim Selection):** 어떤 프로세스의 어떤 자원을 선점할지 최소 비용 원칙에 따라 결정한다.
        - **복귀(Rollback):** 자원을 빼앗긴 프로세스는 이전의 안전한 상태로 복귀(rollback)한 후 재시작해야 한다.
        - **기아 상태(Starvation):** 동일한 프로세스가 계속해서 희생자로 선택되는 것을 방지하기 위해, 희생자 선택 횟수에 제한을 두는 등의 장치가 필요하다.